create database movie;
use movie;

-- TABLES

-- ACTOR
CREATE TABLE ACTOR (
    ACT_ID INTEGER,
    ACT_NAME VARCHAR(20),
    ACT_GENDER CHAR(1),
    PRIMARY KEY (ACT_ID)
);

-- DIRECTOR
CREATE TABLE DIRECTOR (
    DIR_ID INTEGER,
    DIR_NAME VARCHAR(20),
    DIR_PHONE VARCHAR(15), -- Changed to VARCHAR for mobile numbers
    PRIMARY KEY (DIR_ID)
);

-- MOVIES
CREATE TABLE MOVIES (
    MOV_ID INTEGER,
    MOV_TITLE VARCHAR(25),
    MOV_YEAR INTEGER,
    MOV_LANG VARCHAR(12),
    DIR_ID INTEGER,
    PRIMARY KEY (MOV_ID),
    FOREIGN KEY (DIR_ID) REFERENCES DIRECTOR(DIR_ID)
);

-- MOVIE_CAST
CREATE TABLE MOVIE_CAST (
    ACT_ID INTEGER,
    MOV_ID INTEGER,
    ROLE VARCHAR(10),
    PRIMARY KEY (ACT_ID, MOV_ID),
    FOREIGN KEY (ACT_ID) REFERENCES ACTOR(ACT_ID),
    FOREIGN KEY (MOV_ID) REFERENCES MOVIES(MOV_ID)
);

-- RATING
CREATE TABLE RATING (
    MOV_ID INTEGER,
    REV_STARS VARCHAR(25),
    PRIMARY KEY (MOV_ID),
    FOREIGN KEY (MOV_ID) REFERENCES MOVIES(MOV_ID)
);


-- VALUES

-- ACTOR
INSERT INTO ACTOR VALUES (301,'ANUSHKA','F');
INSERT INTO ACTOR VALUES (302,'PRABHAS','M');
INSERT INTO ACTOR VALUES (303,'PUNITH','M');
INSERT INTO ACTOR VALUES (304,'JERMY','M');

-- DIRECTOR
INSERT INTO DIRECTOR VALUES (60,'RAJAMOULI', '875161100');
INSERT INTO DIRECTOR VALUES (61,'HITCHCOCK', '776613891');
INSERT INTO DIRECTOR VALUES (62,'FARAN', '998677653');
INSERT INTO DIRECTOR VALUES (63,'STEVEN SPIELBERG', '898977653');

-- MOVIES
INSERT INTO MOVIES VALUES (1001,'BAHUBALI-2', 2017, 'TELUGU', 60);
INSERT INTO MOVIES VALUES (1002,'BAHUBALI-1', 2015, 'TELUGU', 60);
INSERT INTO MOVIES VALUES (1003,'AKASH', 2008, 'KANNADA', 61);
INSERT INTO MOVIES VALUES (1004,'WAR HORSE', 2011, 'ENGLISH', 63);

-- MOVIE_CAST
INSERT INTO MOVIE_CAST VALUES (301, 1002, 'HEROINE');
INSERT INTO MOVIE_CAST VALUES (301, 1001, 'HEROINE');
INSERT INTO MOVIE_CAST VALUES (303, 1003, 'HERO');
INSERT INTO MOVIE_CAST VALUES (303, 1002, 'GUEST');
INSERT INTO MOVIE_CAST VALUES (304, 1004, 'HERO');

-- RATING
INSERT INTO RATING VALUES (1001, '4');
INSERT INTO RATING VALUES (1002, '2');
INSERT INTO RATING VALUES (1003, '5');
INSERT INTO RATING VALUES (1004, '4');


-- QUERIES

-- 1) List the titles of all movies directed by 'Hitchcock'.
SELECT MOV_TITLE
FROM MOVIES
WHERE DIR_ID = (SELECT DIR_ID FROM DIRECTOR WHERE DIR_NAME = 'HITCHCOCK');

-- 2) Find the movie names where one or more actors acted in two or more movies.
SELECT MOV_TITLE
FROM MOVIES M
INNER JOIN MOVIE_CAST MC ON M.MOV_ID = MC.MOV_ID
WHERE MC.ACT_ID IN (
    SELECT ACT_ID
    FROM MOVIE_CAST
    GROUP BY ACT_ID
    HAVING COUNT(MOV_ID) >= 2
);

-- 3) List all actors who acted in a movie before 2000 and also in a movie after 2015 (use JOIN operation).
SELECT DISTINCT A.ACT_NAME
FROM ACTOR A
JOIN MOVIE_CAST MC ON A.ACT_ID = MC.ACT_ID
JOIN MOVIES M ON MC.MOV_ID = M.MOV_ID
WHERE M.MOV_YEAR < 2000 OR M.MOV_YEAR > 2015;

-- 4) Find the title of movies and number of stars for each movie that has at least one rating and find the highest number of stars that movie received. Sort the result by movie title.
SELECT M.MOV_TITLE, R.REV_STARS
FROM MOVIES M
JOIN RATING R ON M.MOV_ID = R.MOV_ID
WHERE R.REV_STARS IS NOT NULL
ORDER BY M.MOV_TITLE;

-- 5) Update rating of all movies directed by 'Steven Spielberg' to 5KL
UPDATE RATING
SET REV_STARS = '5KL'
WHERE MOV_ID IN (
    SELECT MOV_ID
    FROM MOVIES
    WHERE DIR_ID = (
        SELECT DIR_ID
        FROM DIRECTOR
        WHERE DIR_NAME = 'STEVEN SPIELBERG'
    )
);
